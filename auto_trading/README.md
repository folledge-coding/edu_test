# LS증권 자동매매 시스템

## 개요
LS증권 xingAPI를 이용한 실전용 자동매매 시스템입니다.

## 주요 기능

### 매매 전략
1. **매수**: 수동으로 증권앱에서 직접 매수
2. **매도**: 당일 저가 기준 자동 분할매도
   - 당일 저가 +3%: 보유량의 1/3 매도
   - 당일 저가 +5%: 보유량의 1/3 매도
   - 당일 저가 +7%: 잔량 전량 매도

### 손절 전략
- 한번이라도 매도 후 당일 저가가 갱신되면 전량 손절매도

### 동적 목표가 조정
- 당일 저가가 갱신될 때마다 3%, 5%, 7% 목표가를 자동으로 재계산하여 주문 정정

## 파일 구조
```
auto_trading/
├── main.py                     # 메인 실행 파일
├── globals.py                  # 전역 변수 및 설정
├── .env                        # 환경설정 파일
├── ls_res/                     # LS증권 API 모듈
│   ├── login.py               # 로그인
│   ├── t0424.py               # 보유종목 조회 및 자동매도
│   ├── cspaq12200.py          # 예수금 조회
│   ├── cspat00600.py          # 주식 주문
│   ├── cspat00800.py          # 주식 정정주문
│   ├── sc0.py                 # 실시간 주식체결
│   └── sc1.py                 # 실시간 주문체결
├── database/                   # 데이터베이스 모듈
│   └── trading_db.py          # 거래 데이터 관리
└── remote/                     # 원격 제어
    └── telegram_bot.py        # 텔레그램 봇
```

## 설치 및 설정

### 1. 필요 라이브러리 설치
```bash
pip install python-dotenv
pip install python-telegram-bot
pip install pywin32
```

### 2. 환경설정
`.env` 파일에 본인의 정보 입력:
```
LS-URL=hts.ls-sec.co.kr
LS-ID=본인_LS증권_ID
LS-PASSWORD=본인_LS증권_비밀번호
LS-CERT=공인인증서_비밀번호
LS-ACC=계좌번호
LS-ACC-PWD=계좌비밀번호

TELEGRAM-TOKEN=텔레그램_봇_토큰
TELEGRAM-CHAT-ID=텔레그램_채팅_ID
```

### 3. LS증권 xingAPI 설치
- LS증권 xingAPI를 `C:/LS_SEC/xingAPI/` 경로에 설치

### 4. SQLite 데이터베이스 경로 생성
```bash
mkdir C:/sqlite_db
```

## 실행 방법

```bash
python main.py
```

## 텔레그램 명령어

- `/help` - 도움말
- `/status` - 현재 보유종목 상태
- `/summary` - 오늘 거래 요약
- `/positions` - 포지션 상세정보
- `/stop` - 시스템 중지 (긴급시)
- `/start` - 시스템 재시작

## 주요 특징

### 1. 안전한 자동매도
- 사용자가 수동으로 매수한 종목을 자동으로 감지
- 당일 저가 기준으로 안전한 매도 전략 실행

### 2. 실시간 모니터링
- 실시간 시세 변동 감지
- 저가 갱신 시 즉시 목표가 재조정

### 3. 텔레그램 알림
- 모든 매도 주문 알림
- 저가 갱신 알림
- 손절매도 알림

### 4. 데이터 보존
- 포지션 정보 자동 백업
- 거래 내역 기록

## 주의사항

1. **매수는 반드시 수동으로**: 이 시스템은 매도만 자동화됩니다.
2. **충분한 테스트**: 실전 전에 모의투자로 충분히 테스트하세요.
3. **시장 상황 주의**: 급락장에서는 손절 기능이 작동할 수 있습니다.
4. **시스템 모니터링**: 텔레그램을 통해 지속적으로 모니터링하세요.

## 리스크 관리

- 당일 저가 갱신 시 자동 손절
- 분할매도로 리스크 분산
- 실시간 모니터링 및 알림

## 기술적 세부사항

### 매도 수량 계산
```python
total_qty = 보유수량
sell_3_qty = total_qty // 3      # 3% 매도량
sell_5_qty = total_qty // 3      # 5% 매도량  
sell_7_qty = total_qty - (sell_3_qty + sell_5_qty)  # 7% 매도량
```

### 목표가 계산
```python
target_3_price = int(today_low * 1.03)  # 3% 목표가
target_5_price = int(today_low * 1.05)  # 5% 목표가
target_7_price = int(today_low * 1.07)  # 7% 목표가
```

## 문제해결

### 1. 로그인 실패
- `.env` 파일의 계정 정보 확인
- LS증권 xingAPI 설치 경로 확인

### 2. 주문 실패
- 계좌번호 및 비밀번호 확인
- 매도 가능 수량 확인

### 3. 텔레그램 알림 안됨
- 봇 토큰 및 채팅 ID 확인
- 인터넷 연결 상태 확인

---

**⚠️ 투자 위험 고지**
이 시스템은 보조 도구이며, 모든 투자 결정과 손익은 사용자 본인의 책임입니다.
충분한 테스트 후 사용하시기 바랍니다.
